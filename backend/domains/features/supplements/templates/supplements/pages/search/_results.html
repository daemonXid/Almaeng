{% load humanize %}
{% if supplements %}
<div class="mb-4 flex items-center justify-between px-1">
    <h2 class="font-bold text-gray-800 dark:text-white text-sm">
        ê²€ìƒ‰ ê²°ê³¼ <span class="text-emerald-600">{{ supplements|length }}</span>ê±´
    </h2>
</div>

<!-- Product List -->
<div class="space-y-4">
    {% for product in supplements %}
    <a href="{% url 'supplements:detail' product.id %}" class="block group">
        <div
            class="bg-white dark:bg-gray-800 rounded-3xl p-4 border border-gray-100 dark:border-gray-700 shadow-sm group-hover:shadow-md transition-all flex gap-4">
            <!-- Image -->
            <div
                class="w-24 h-24 rounded-2xl bg-gray-50 flex items-center justify-center shrink-0 p-2 overflow-hidden relative">
                {% if product.image_url %}
                <img src="{{ product.image_url }}" alt="{{ product.name }}"
                    class="w-full h-full object-contain mix-blend-multiply">
                {% else %}
                <span class="text-3xl">ğŸ’Š</span>
                {% endif %}

                <!-- Rank Badge (Top 3) - Logic can be improved -->
                {% if forloop.counter <= 3 and query %} <div
                    class="absolute top-0 left-0 bg-yellow-400 text-yellow-900 text-[10px] font-bold px-1.5 py-0.5 rounded-br-lg shadow-sm">
                    TOP {{ forloop.counter }}
            </div>
            {% endif %}
        </div>

        <!-- Info -->
        <div class="flex-1 min-w-0 flex flex-col justify-between py-1">
            <div>
                <div class="flex justify-between items-start">
                    <span class="text-xs font-bold text-gray-500 mb-0.5 truncate">{{ product.brand|default:"ë¸Œëœë“œ ì •ë³´ ì—†ìŒ"
                        }}</span>
                    {% if product.benefits %}
                    <span
                        class="px-1.5 py-0.5 rounded bg-indigo-50 text-[10px] font-bold text-indigo-600 border border-indigo-100">AI
                        âœ¨</span>
                    {% endif %}
                </div>
                <h3
                    class="font-bold text-gray-900 dark:text-white leading-tight line-clamp-2 mb-1 group-hover:text-emerald-600 transition-colors text-sm sm:text-base">
                    {{ product.name }}
                </h3>
            </div>

            <!-- AI Description Snippet -->
            {% if product.description %}
            <p class="text-xs text-indigo-500 line-clamp-1 mb-2 bg-indigo-50 px-2 py-1 rounded-lg inline-block w-fit">âœ¨
                {{ product.description }}</p>
            {% endif %}

            <!-- Footer -->
            <div class="flex items-center justify-end gap-1 text-xs font-semibold text-emerald-600 mt-auto">
                <span>ìƒì„¸ì •ë³´</span>
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </div>
        </div>
</div>
</a>
{% endfor %}
</div>
{% else %}
<div class="text-center py-16">
    <p class="text-5xl mb-4 grayscale opacity-50">ğŸƒ</p>
    <p class="font-bold text-gray-600 dark:text-gray-300">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”.</p>
    <p class="text-sm text-gray-500 mt-2">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”!</p>
</div>
{% endif %}